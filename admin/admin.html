<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>HBUB 이벤트 관리자</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: 'Arial', sans-serif; background: #fffdf7; padding: 1rem; }
    h1, h2 { color: #cc6600; }
    .container { max-width: 800px; margin: auto; }
    form, .event { background: #fff3d1; margin: 1rem 0; padding: 1rem; border-radius: 10px; }
    input, textarea, button {
      width: 100%; margin: 0.3rem 0; padding: 0.5rem;
      border: 1px solid #ccc; border-radius: 5px;
    }
    .hidden { display: none; }
    .event small { color: #888; }
    .actions { display: flex; gap: 10px; margin-top: 0.5rem; }
    .actions button { flex: 1; }
  </style>
</head>
<body>
  <div class="container">
    <h1>🔐 HBUB 관리자</h1>

    <!-- 로그인 -->
    <form id="loginForm">
      <input type="password" id="loginPw" placeholder="비밀번호 입력" required />
      <button type="submit">로그인</button>
    </form>

    <!-- 관리자 영역 -->
    <div id="adminPanel" class="hidden">
      <h2>이벤트 등록</h2>
      <form id="eventForm">
        <input type="text" id="eventTitle" placeholder="이벤트 제목" required />
        <textarea id="eventDesc" placeholder="이벤트 설명" required></textarea>
        <input type="date" id="eventDate" required />
        <input type="hidden" id="editIndex" />
        <button type="submit">저장</button>
      </form>

      <h2>등록된 이벤트</h2>
      <div id="eventList"></div>

      <form id="changePwForm">
        <input type="password" id="newPw" placeholder="새 비밀번호 변경" required />
        <button type="submit">비밀번호 변경</button>
      </form>

      <button onclick="logout()">로그아웃</button>
    </div>
  </div>

  <script>
    const loginForm = document.getElementById('loginForm');
    const adminPanel = document.getElementById('adminPanel');
    const eventForm = document.getElementById('eventForm');
    const eventList = document.getElementById('eventList');

    async function hashPassword(pw) {
      const buf = new TextEncoder().encode(pw);
      const digest = await crypto.subtle.digest("SHA-256", buf);
      return Array.from(new Uint8Array(digest)).map(b => b.toString(16).padStart(2, "0")).join("");
    }

    // 초기 비밀번호 설정
    if (!localStorage.getItem("adminHash")) {
      hashPassword("admin123").then(hash => {
        localStorage.setItem("adminHash", hash);
      });
    }

    // 로그인 처리
    loginForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const inputPw = document.getElementById("loginPw").value;
      const inputHash = await hashPassword(inputPw);
      if (inputHash === localStorage.getItem("adminHash")) {
        localStorage.setItem("isAdmin", "true");
        showAdmin();
      } else {
        alert("비밀번호가 틀렸습니다.");
      }
    });

    function showAdmin() {
      loginForm.classList.add("hidden");
      adminPanel.classList.remove("hidden");
      renderEvents();
    }

    // 로그아웃
    function logout() {
      localStorage.removeItem("isAdmin");
      location.reload();
    }

    // 비밀번호 변경
    document.getElementById("changePwForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const newPw = document.getElementById("newPw").value;
      const newHash = await hashPassword(newPw);
      localStorage.setItem("adminHash", newHash);
      alert("비밀번호가 변경되었습니다.");
    });

    // 이벤트 저장
    eventForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const title = document.getElementById("eventTitle").value;
      const desc = document.getElementById("eventDesc").value;
      const date = document.getElementById("eventDate").value;
      const editIndex = document.getElementById("editIndex").value;

      const events = JSON.parse(localStorage.getItem("events") || "[]");

      if (editIndex === "") {
        events.push({ title, desc, date });
      } else {
        events[editIndex] = { title, desc, date };
      }

      localStorage.setItem("events", JSON.stringify(events));
      eventForm.reset();
      document.getElementById("editIndex").value = "";
      renderEvents();
    });

    // 이벤트 출력
    function renderEvents() {
      const events = JSON.parse(localStorage.getItem("events") || "[]");
      eventList.innerHTML = "";

      events.forEach((event, index) => {
        const div = document.createElement("div");
        div.className = "event";
        div.innerHTML = `
          <strong>${event.title}</strong>
          <p>${event.desc}</p>
          <small>등록일: ${event.date}</small>
          <div class="actions">
            <button onclick="editEvent(${index})">수정</button>
            <button onclick="deleteEvent(${index})">삭제</button>
          </div>
        `;
        eventList.appendChild(div);
      });
    }

    // 이벤트 수정
    function editEvent(index) {
      const events = JSON.parse(localStorage.getItem("events") || "[]");
      const e = events[index];
      document.getElementById("eventTitle").value = e.title;
      document.getElementById("eventDesc").value = e.desc;
      document.getElementById("eventDate").value = e.date;
      document.getElementById("editIndex").value = index;
    }

    // 이벤트 삭제
    function deleteEvent(index) {
      if (!confirm("삭제하시겠습니까?")) return;
      const events = JSON.parse(localStorage.getItem("events") || "[]");
      events.splice(index, 1);
      localStorage.setItem("events", JSON.stringify(events));
      renderEvents();
    }

    // 로그인 유지 시 자동 진입
    if (localStorage.getItem("isAdmin") === "true") {
      showAdmin();
    }
  </script>
</body>
</html>
