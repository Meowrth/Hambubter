<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>HBUB ì´ë²¤íŠ¸ ê´€ë¦¬ì</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: 'Arial', sans-serif; background: #fffdf7; padding: 1rem; }
    h1, h2 { color: #cc6600; }
    .container { max-width: 800px; margin: auto; }
    form, .event { background: #fff3d1; margin: 1rem 0; padding: 1rem; border-radius: 10px; }
    input, textarea, button {
      width: 100%; margin: 0.3rem 0; padding: 0.5rem;
      border: 1px solid #ccc; border-radius: 5px;
    }
    .hidden { display: none; }
    .event small { color: #888; }
    .actions { display: flex; gap: 10px; margin-top: 0.5rem; }
    .actions button { flex: 1; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” HBUB ê´€ë¦¬ì</h1>

    <!-- ë¡œê·¸ì¸ -->
    <form id="loginForm">
      <input type="password" id="loginPw" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" required />
      <button type="submit">ë¡œê·¸ì¸</button>
    </form>

    <!-- ê´€ë¦¬ì ì˜ì—­ -->
    <div id="adminPanel" class="hidden">
      <h2>ì´ë²¤íŠ¸ ë“±ë¡</h2>
      <form id="eventForm">
        <input type="text" id="eventTitle" placeholder="ì´ë²¤íŠ¸ ì œëª©" required />
        <textarea id="eventDesc" placeholder="ì´ë²¤íŠ¸ ì„¤ëª…" required></textarea>
        <input type="date" id="eventDate" required />
        <input type="hidden" id="editIndex" />
        <button type="submit">ì €ì¥</button>
      </form>

      <h2>ë“±ë¡ëœ ì´ë²¤íŠ¸</h2>
      <div id="eventList"></div>

      <form id="changePwForm">
        <input type="password" id="newPw" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½" required />
        <button type="submit">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
      </form>

      <button onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
  </div>

  <script>
    const loginForm = document.getElementById('loginForm');
    const adminPanel = document.getElementById('adminPanel');
    const eventForm = document.getElementById('eventForm');
    const eventList = document.getElementById('eventList');

    async function hashPassword(pw) {
      const buf = new TextEncoder().encode(pw);
      const digest = await crypto.subtle.digest("SHA-256", buf);
      return Array.from(new Uint8Array(digest)).map(b => b.toString(16).padStart(2, "0")).join("");
    }

    // ì´ˆê¸° ë¹„ë°€ë²ˆí˜¸ ì„¤ì •
    if (!localStorage.getItem("adminHash")) {
      hashPassword("admin123").then(hash => {
        localStorage.setItem("adminHash", hash);
      });
    }

    // ë¡œê·¸ì¸ ì²˜ë¦¬
    loginForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const inputPw = document.getElementById("loginPw").value;
      const inputHash = await hashPassword(inputPw);
      if (inputHash === localStorage.getItem("adminHash")) {
        localStorage.setItem("isAdmin", "true");
        showAdmin();
      } else {
        alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
      }
    });

    function showAdmin() {
      loginForm.classList.add("hidden");
      adminPanel.classList.remove("hidden");
      renderEvents();
    }

    // ë¡œê·¸ì•„ì›ƒ
    function logout() {
      localStorage.removeItem("isAdmin");
      location.reload();
    }

    // ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
    document.getElementById("changePwForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const newPw = document.getElementById("newPw").value;
      const newHash = await hashPassword(newPw);
      localStorage.setItem("adminHash", newHash);
      alert("ë¹„ë°€ë²ˆí˜¸ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.");
    });

    // ì´ë²¤íŠ¸ ì €ì¥
    eventForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const title = document.getElementById("eventTitle").value;
      const desc = document.getElementById("eventDesc").value;
      const date = document.getElementById("eventDate").value;
      const editIndex = document.getElementById("editIndex").value;

      const events = JSON.parse(localStorage.getItem("events") || "[]");

      if (editIndex === "") {
        events.push({ title, desc, date });
      } else {
        events[editIndex] = { title, desc, date };
      }

      localStorage.setItem("events", JSON.stringify(events));
      eventForm.reset();
      document.getElementById("editIndex").value = "";
      renderEvents();
    });

    // ì´ë²¤íŠ¸ ì¶œë ¥
    function renderEvents() {
      const events = JSON.parse(localStorage.getItem("events") || "[]");
      eventList.innerHTML = "";

      events.forEach((event, index) => {
        const div = document.createElement("div");
        div.className = "event";
        div.innerHTML = `
          <strong>${event.title}</strong>
          <p>${event.desc}</p>
          <small>ë“±ë¡ì¼: ${event.date}</small>
          <div class="actions">
            <button onclick="editEvent(${index})">ìˆ˜ì •</button>
            <button onclick="deleteEvent(${index})">ì‚­ì œ</button>
          </div>
        `;
        eventList.appendChild(div);
      });
    }

    // ì´ë²¤íŠ¸ ìˆ˜ì •
    function editEvent(index) {
      const events = JSON.parse(localStorage.getItem("events") || "[]");
      const e = events[index];
      document.getElementById("eventTitle").value = e.title;
      document.getElementById("eventDesc").value = e.desc;
      document.getElementById("eventDate").value = e.date;
      document.getElementById("editIndex").value = index;
    }

    // ì´ë²¤íŠ¸ ì‚­ì œ
    function deleteEvent(index) {
      if (!confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
      const events = JSON.parse(localStorage.getItem("events") || "[]");
      events.splice(index, 1);
      localStorage.setItem("events", JSON.stringify(events));
      renderEvents();
    }

    // ë¡œê·¸ì¸ ìœ ì§€ ì‹œ ìë™ ì§„ì…
    if (localStorage.getItem("isAdmin") === "true") {
      showAdmin();
    }
  </script>
</body>
</html>
